
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Dashboard | E-Commerce</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
:root {
  --bg-color:#0f111a;
  --card-bg:#1a1c26;
  --sidebar-bg:#141620;
  --text-main:#fff;
  --text-muted:#a0a0a0;
  --accent-blue:#4dabf7;
  --border-color:#2d303e;
}
body {
  background:var(--bg-color);
  color:var(--text-main);
  font-family:Inter,sans-serif;
  overflow-x:hidden;
}
#sidebar {
  width:250px;height:100vh;
  background:var(--sidebar-bg);
  position:fixed;
  border-right:1px solid var(--border-color);
  transition:.3s;
}
#content {
  margin-left:250px;
  padding:30px;
  transition:.3s;
}
.card-custom {
  background:var(--card-bg);
  border:1px solid var(--border-color);
  border-radius:12px;
  padding:20px;
}
.metric-value { font-size:1.8rem;font-weight:700; }
.metric-label { color:var(--text-muted); }
.icon-box {
  width:45px;height:45px;
  border-radius:10px;
  display:flex;align-items:center;justify-content:center;
  background:rgba(77,171,247,.15);
  color:var(--accent-blue);
}
.list-group-item {
  border-color:var(--border-color);
}
@media(max-width:992px){
  #sidebar{margin-left:-250px}
  #sidebar.active{margin-left:0}
  #content{margin-left:0}
  #content.active{margin-left:250px}
}
</style>
</head>
<body>
<%- include("../partials/adminSide-bar.ejs") %>
<div id="content">
<!-- Header -->
<div class="d-flex justify-content-between align-items-center mb-4">
  <button class="btn btn-dark d-lg-none" id="sidebarCollapse">
    <i class="fas fa-bars"></i>
  </button>
  <h3 class="fw-bold mb-0">Dashboard</h3>
</div>
<!-- Metrics -->
<div class="row g-4 mb-4">
<div class="col-md-3">
  <div class="card-custom d-flex justify-content-between">
    <div>
      <div class="metric-label">Total Sales</div>
      <div class="metric-value">₹<%= dashboard.totalSales || 0 %></div>
    </div>
    <div class="icon-box"><i class="fas fa-dollar-sign"></i></div>
  </div>
</div>
<div class="col-md-3">
  <div class="card-custom d-flex justify-content-between">
    <div>
      <div class="metric-label">Orders</div>
      <div class="metric-value"><%= dashboard.totalOrders || 0 %></div>
    </div>
    <div class="icon-box"><i class="fas fa-shopping-basket"></i></div>
  </div>
</div>
<div class="col-md-3">
  <div class="card-custom d-flex justify-content-between">
    <div>
      <div class="metric-label">Customers</div>
      <div class="metric-value"><%= dashboard.totalUsers || 0 %></div>
    </div>
    <div class="icon-box"><i class="fas fa-user-friends"></i></div>
  </div>
</div>
<div class="col-md-3">
  <div class="card-custom d-flex justify-content-between">
    <div>
      <div class="metric-label">Revenue</div>
      <div class="metric-value">₹<%= dashboard.totalRevenue || 0 %></div>
    </div>
    <div class="icon-box"><i class="fas fa-wallet"></i></div>
  </div>
</div>
</div>
<!-- Charts -->
<div class="row g-4 mb-4">
<div class="col-lg-8">
<div class="card-custom">
<div class="d-flex gap-2 mb-3">
  <a href="/admin?range=daily" class="btn btn-sm btn-outline-light">Daily</a>
  <a href="/admin?range=monthly" class="btn btn-sm btn-outline-light">Monthly</a>
  <a href="/admin?range=yearly" class="btn btn-sm btn-outline-light">Yearly</a>
</div>
<h5 class="fw-bold mb-3">Sales Analytics</h5>
<% if(!salesChart || salesChart.length === 0){ %>
<p class="text-muted text-center">No sales data available</p>
<% } else { %>
<canvas id="salesAnalyticsChart"></canvas>
<% } %>
</div>
</div>
<div class="col-lg-4">
<div class="card-custom">
<h5 class="fw-bold mb-3">Payment Methods</h5>
<% if(!paymentChart || paymentChart.length === 0){ %>
<p class="text-muted text-center">No payment data</p>
<% } else { %>
<canvas id="trafficSourceChart"></canvas>
<% } %>
</div>
</div>
</div>
<!-- Top Selling -->
<div class="row g-4 mt-4">
<div class="col-lg-4">
<div class="card-custom">
<h5 class="fw-bold mb-3">Top 10 Products</h5>
<ul class="list-group list-group-flush">
<% topProducts.forEach(i=>{ %>
<li class="list-group-item bg-transparent text-white d-flex justify-content-between">
<span><%= i.product.productName %></span>
<span class="text-muted"><%= i.soldQty %></span>
</li>
<% }) %>
</ul>
</div>
</div>
<div class="col-lg-4">
<div class="card-custom">
<h5 class="fw-bold mb-3">Top 10 Categories</h5>
<ul class="list-group list-group-flush">
<% topCategories.forEach(i=>{ %>
<li class="list-group-item bg-transparent text-white d-flex justify-content-between">
<span><%= i.category.name %></span>
<span class="text-muted"><%= i.soldQty %></span>
</li>
<% }) %>
</ul>
</div>
</div>
<div class="col-lg-4">
<div class="card-custom">
<h5 class="fw-bold mb-3">Top 10 Brands</h5>
<ul class="list-group list-group-flush">
<% topBrands.forEach(i=>{ %>
<li class="list-group-item bg-transparent text-white d-flex justify-content-between">
<span><%= i.brand %></span>
<span class="text-muted"><%= i.soldQty %></span>
</li>
<% }) %>
</ul>
</div>
</div>
</div>
</div>


<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const sidebar=document.getElementById("sidebar");
const content=document.getElementById("content");
document.getElementById("sidebarCollapse").onclick=()=>{
  sidebar.classList.toggle("active");
  content.classList.toggle("active");
};
document.addEventListener("DOMContentLoaded", function () {
  const salesChartData = <%- JSON.stringify(salesChart || []) %>;
  const paymentChartData = <%- JSON.stringify(paymentChart || []) %>;
  console.log("Sales Data:", salesChartData);
  /* ================= SALES LINE CHART ================= */
  if (salesChartData.length > 0) {
    const salesLabels = salesChartData.map(item => item._id);
    const salesValues = salesChartData.map(item => item.total);
    const salesCanvas = document.getElementById("salesAnalyticsChart");
    if (salesCanvas) {
      new Chart(salesCanvas, {
        type: "line",
        data: {
          labels: salesLabels,
          datasets: [{
            label: "Sales",
            data: salesValues,
            borderColor: "#4dabf7",
            backgroundColor: "rgba(77,171,247,0.2)",
            tension: 0.4,
            fill: true
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: { display: false }
          }
        }
      });
    }
  }
  /* ================= PAYMENT PIE CHART ================= */
  if (paymentChartData.length > 0) {
    const paymentLabels = paymentChartData.map(i => i._id);
    const paymentValues = paymentChartData.map(i => i.count);
    const paymentCanvas = document.getElementById("trafficSourceChart");
    if (paymentCanvas) {
      new Chart(paymentCanvas, {
        type: "pie",
        data: {
          labels: paymentLabels,
          datasets: [{
            data: paymentValues
          }]
        },
        options: {
          responsive: true
        }
      });
    }
  }
});
</script>
</body>
</html>
