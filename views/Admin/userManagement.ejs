<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>User Management</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<style>
     body {
      margin: 0;
      font-family: Arial, sans-serif;
      background:  #1e1e1e;
      color: #fff;
    }

    /* ===== SIDEBAR ===== */
    .sidebar {
      width: 240px;
      position: fixed;
      top: 0;
      left: 0;
      height: 100vh;
      background: #1c1c1c;
      padding-top: 20px;
      display: flex;
      flex-direction: column;
    }

    .sidebar h4 {
      margin-bottom: 20px;
      font-weight: bold;
      color: #fff;
    }

    .sidebar a {
      color: white;
      text-decoration: none;
      padding: 10px 20px;
      display: flex;
      align-items: center;
      gap: 10px;
      border-radius: 5px;
      margin: 2px 10px;
      transition: background 0.2s;
    }

    .sidebar a:hover {
      background: #333;
    }

    .sidebar a.text-danger:hover {
      background: #aa2222;
    }

    /* ===== MAIN CONTENT ===== */
    .main-content {
      margin-left: 240px;
      padding: 24px 20px 60px 20px;
    }

    /* Card-like container */
    .card-dark {
       background: #1e1e1e;
      border: 1px solid #333;
      color: #fff;
        padding: 20px;
        border-radius: 8px;
    }

    .card-dark h2 {
        color: #fff;
        margin-bottom: 20px;
    }

    /* Table */
    .table-dark {
        background-color: #111;
        border: 1px solid #222;
    }
    .table-dark th, .table-dark td {
        border-color: #222;
        color: white;
    }

    /* Buttons */
    .btn-primary {
        background-color: #0d6efd;
        border-color: #0d6efd;
    }
    .btn-primary:hover {
        background-color: #0b5ed7;
    }
    .btn-success {
        background-color: #198754;
        border-color: #198754;
    }
    .btn-success:hover {
        background-color: #157347;
    }
    .btn-danger {
        background-color: #dc3545;
        border-color: #dc3545;
    }
    .btn-danger:hover {
        background-color: #bb2d3b;
    }
    .btn-secondary {
        background-color: #6c757d;
        border-color: #6c757d;
    }

    /* Pagination */
    .pagination .page-item.active .page-link {
        background-color: #575757;
        border-color: #444;
        color: #fff;
    }

    /* Input fields */
    .form-control, .form-select {
        background-color: #1c1c1c;
        color: white;
        border: 1px solid #444;
    }
    .form-control::placeholder {
        color: #888;
    }
</style>
</head>
<body>

  <!-- ===== SIDEBAR ===== -->
  <div class="sidebar">
    <h4 class="text-center">Admin</h4>
    <a href="/admin"><i class="fas fa-tachometer-alt"></i> Dashboard</a>
    <a href="/admin/users"><i class="fas fa-users"></i> Users</a>
    <a href="/admin/orders"><i class="fas fa-users"></i> Orders</a>
    <a href="/admin/products"><i class="fas fa-box"></i> Products</a>
    <a href="/admin/addProducts"><i class="fas fa-plus"></i> Add Product</a>
    <a href="/admin/category"><i class="fas fa-tags"></i> Categories</a>
    <a href="/admin/logout" class="text-danger"><i class="fas fa-sign-out-alt"></i> Logout</a>
  </div>

<!-- Main Content -->
<div class="main-content">
    <div class="card-dark">
        <h2>User Management</h2>

        <!-- Search -->
        <form method="GET" action="/admin/users" class="mb-3 d-flex align-items-center gap-2">  
            <input type="text" name="search" value="<%= search || '' %>" class="form-control w-25" placeholder="Search users...">
            <button type="submit" class="btn btn-primary">Search</button>
            <a href="/admin/users" class="btn btn-secondary">Clear</a>
        </form>

        <!-- Users Table -->
        <table class="table table-dark table-striped">
            <thead>
                <tr>
                    <th>Username</th>
                    <th>Email</th>
                    <th>Phone Number</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                <% users.forEach(user => { %>
                    <tr>
                        <td><%= user.name %></td>
                        <td><%= user.email %></td>
                        <td><%= user.phoneNumber %></td>
                        <td>
                            <% if (user.isBlocked) { %>
                                <button class="btn btn-success" onclick="confirmAction('<%= user._id %>', 'unblock')">Unblock</button>
                            <% } else { %>
                                <button class="btn btn-danger" onclick="confirmAction('<%= user._id %>', 'block')">Block</button>
                            <% } %>
                        </td>
                    </tr>
                <% }) %>
            </tbody>
        </table>

        <!-- Pagination -->
        <nav>
            <ul class="pagination">
                <% for (let i = 1; i <= Math.ceil(totalUsers / limit); i++) { %>
                    <li class="page-item <%= page === i ? 'active' : '' %>">
                        <a class="page-link" href="/admin/users?page=<%= i %>&search=<%= search || '' %>"><%= i %></a>
                    </li>
                <% } %>
            </ul>
        </nav>
    </div>
</div>

<script>
function confirmAction(userId, action) {
    Swal.fire({
        title: 'Are you sure?',
        text: `You are about to ${action} this user!`,
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: action === 'block' ? '#d33' : '#3085d6',
        cancelButtonColor: '#6c757d',
        confirmButtonText: action === 'block' ? 'Yes, Block!' : 'Yes, Unblock!'
    }).then((result) => {
        if (result.isConfirmed) {
            fetch(`/admin/users/${userId}/${action}`, { 
                method: 'POST',
                headers: { 'Content-Type': 'application/json' } 
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    Swal.fire('Success!', data.message, 'success').then(() => {
                        window.location.reload();
                    });
                } else {
                    Swal.fire('Error!', data.message, 'error');
                }
            })
            .catch(() => Swal.fire('Error!', 'Something went wrong!', 'error'));
        }
    });
}
</script>

</body>
</html>
